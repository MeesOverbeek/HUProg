import requests
import xmltodict
import time
from tkinter import *
from tkinter import ttk
from tkinter.messagebox import showinfo
#from Treinfuncties import * #calls upon Treinfuncties.py

authDetails = ('mees-overbeek@hotmail.com', 'xyy3hgLOXBq1i3sNZgp5qVwLPraeb4APZw_JI2iEB-zP3qfpfsj9fg')
apiUrl = 'http://webservices.ns.nl/ns-api-avt?station=ut'
response = requests.get(apiUrl, auth = authDetails)

vertrekXML = xmltodict.parse(response.text)


#form functions to perform commands, functions need to remain outside the tkinter frame code (remain global)
root = Tk()

label = Label(master=root,
              text='Een hele goede dag',
              background='pink',
              foreground='blue',
              font=('Helvetica', 16, 'bold italic'),
              width=20,
              height=10)

def GetDepartures(StationName):
    'requests API URL and login-in credentials'
    authDetails = ('mees-overbeek@hotmail.com', 'xyy3hgLOXBq1i3sNZgp5qVwLPraeb4APZw_JI2iEB-zP3qfpfsj9fg')
    apiUrl = 'http://webservices.ns.nl/ns-api-avt?station=' + StationName
    response = requests.get(apiUrl, auth = authDetails)
    vertrekXML = xmltodict.parse(response.text)

#an exceptionerror if the API fails to work
    if "error" in vertrekXML.keys():
        print(vertrekXML["error"]["message"])
        exit()



#prints the current departure times for the current
    for vertrek in vertrekXML['ActueleVertrekTijden']['VertrekkendeTrein']:
        eindbestemming = vertrek['EindBestemming']

        vertrektijd = vertrek['VertrekTijd']

        vertrektijd = vertrektijd[11:16]



StationName = input("Geef uw Station op: ")
GetDepartures(StationName)

def clicked():
    bericht = 'Dit een bericht voor de gebruiker!'
    showinfo(master=root, title='popup', message=bericht)

def stationClick():
    showinfo(master=root, title='treinen', command=vertrekker())

def vertrekker():
    for vertrek in vertrekXML['ActueleVertrekTijden']['VertrekkendeTrein']:
        eindbestemming = vertrek['EindBestemming']

        vertrektijd = vertrek['VertrekTijd']

        vertrektijd = vertrektijd[11:19]

        showinfo(message='Om ' + vertrektijd + ' vertrekt een trein naar ' + eindbestemming)

stationList = []


button = Button(master=root, text='Druk hier', command=stationClick)
button.pack()

stationEntry = Entry(master=root)
stationEntry.pack()

label.pack()

#ensures the given command works

entry = Entry()

root.mainloop()
